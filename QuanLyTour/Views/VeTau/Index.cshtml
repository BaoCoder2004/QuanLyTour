@using QuanLyTour.Models.VeTau
@model VeTauSearchViewModel
@{
    ViewData["Title"] = "Trang chủ - Vé tàu";
}

<div class="search-tabs" id="search-tabs-3">
    <div class="container">
        <div class="row">
            <div class="hidden-xs hidden-sm col-md-12 no-pd-l">
                <div class="welcome-message">
                    <h2>LỰA CHỌN CHUYẾN TÀU PHÙ HỢP NHẤT</h2>
                    <p>
                        💥 Bạn đang tìm kiếm một chuyến tàu thuận tiện để di chuyển? <br />
                        👉 Nhiều tuyến tàu đến các địa điểm du lịch hấp dẫn, với giá vé tốt và lịch trình đa dạng
                    <p> ⚡️ Hãy đặt vé tàu cùng HANOITOUR ngay hôm nay! </p>

                    <div class="search-form-container" style="margin-top:20px">
                        <div class="row">
                            <form id="search-form" class="search-container" method="post" action="@Url.Action("TimKiemVeTau", "VeTau")">
                                <div class="trip-type">
                                    <label class="trip-option">
                                        <input type="radio" name="tripType" id="round-trip" checked>
                                        <span class="radio-label">Khứ hồi</span>
                                    </label>
                                    <label class="trip-option">
                                        <input type="radio" name="tripType" id="one-way">
                                        <span class="radio-label">Một chiều</span>
                                    </label>
                                </div>

                                <div class="search-form">
                                    <div class="form-row">
                                        <div class="station-selector">
                                            <div class="station-input">
                                                <i class="fa fa-train"></i>
                                                <div class="station-details">
                                                    <div class="label">Ga đi</div>
                                                    <select id="from-station" name="GaDi" class="station-dropdown">
                                                        <option value="Hà Nội">Hà Nội (HNO)</option>
                                                        <option value="Sài Gòn">Sài Gòn (SGO)</option>
                                                        <option value="Đà Nẵng">Đà Nẵng (DNA)</option>
                                                        <option value="Huế">Huế (HUE)</option>
                                                        <option value="Nha Trang">Nha Trang (NTR)</option>
                                                        <option value="Phan Thiết">Phan Thiết (PTH)</option>
                                                        <option value="Hải Phòng">Hải Phòng (HPH)</option>
                                                        <option value="Đà Lạt">Đà Lạt (DLT)</option>
                                                        <option value="Vũng Tàu">Vũng Tàu (VTU)</option>
                                                        <option value="Đồng Hới">Đồng Hới (DHI)</option>
                                                        <option value="Lào Cai">Lào Cai (LCA)</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div id="swap-stations" class="swap-button">
                                                <i class="fa fa-exchange"></i>
                                            </div>

                                            <div class="station-input">
                                                <i class="fa fa-train"></i>
                                                <div class="station-details">
                                                    <div class="label">Ga đến</div>
                                                    <select id="to-station" name="GaDen" class="station-dropdown">
                                                        <option value="Sài Gòn">Sài Gòn (SGO)</option>
                                                        <option value="Hà Nội">Hà Nội (HNO)</option>
                                                        <option value="Đà Nẵng">Đà Nẵng (DNA)</option>
                                                        <option value="Huế">Huế (HUE)</option>
                                                        <option value="Nha Trang">Nha Trang (NTR)</option>
                                                        <option value="Phan Thiết">Phan Thiết (PTH)</option>
                                                        <option value="Hải Phòng">Hải Phòng (HPH)</option>
                                                        <option value="Đà Lạt">Đà Lạt (DLT)</option>
                                                        <option value="Vũng Tàu">Vũng Tàu (VTU)</option>
                                                        <option value="Đồng Hới">Đồng Hới (DHI)</option>
                                                        <option value="Lào Cai">Lào Cai (LCA)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="ticket-quantity">
                                            <i class="fa fa-user"></i>
                                            <div class="quantity-details">
                                                <div class="label">Số lượng vé</div>
                                                <div class="quantity-control">
                                                    <button type="button" id="decrease-tickets" class="quantity-btn">-</button>
                                                    <span id="ticket-count-display" class="quantity">1 vé</span>
                                                    <button type="button" id="increase-tickets" class="quantity-btn">+</button>
                                                    <input type="hidden" id="ticket-count" name="SoLuongVe" value="1">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="date-picker">
                                            <div class="date-details">
                                                <label for="depart-date" class="form-label">Ngày đi</label>
                                                <input type="date" id="depart-date" name="NgayDi" class="form-control">
                                            </div>
                                        </div>

                                        <div id="return-date-container" class="date-picker">
                                            <div class="date-details">
                                                <label for="return-date" class="form-label">Ngày về</label>
                                                <input type="date" id="return-date" name="NgayVe" class="form-control">
                                            </div>
                                        </div>

                                        <button type="submit" class="search-button">TÌM KIẾM</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- end row -->
    </div><!-- end container -->
</div><!-- end search-tabs -->
<!-- Phần hiển thị bản đồ ga tàu -->
<div class="map-train">
    <div class="page-heading white-heading">
        <h2 style="color:black;">BẢN ĐỒ TUYẾN ĐƯỜNG SẮT VIỆT NAM</h2>
        <hr class="heading-line" />
    </div><!-- end page-heading -->
    <img src="~/images/ban_do.png" alt="Ban do ga tau" class="w-full h-full">
</div>

<!-- Phần hiển thị danh sách vé tàu -->
<section class="ticket-list-section">
    <div class="container">
        <div class="page-heading white-heading">
            <h2 style="color:black;">DANH MỤC VÉ TÀU</h2>
            <hr class="heading-line" />
        </div><!-- end page-heading -->
        <!-- Hiển thị thông báo lỗi nếu có -->
        @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
        {
            <div class="alert alert-danger">@ViewBag.ErrorMessage</div>
        }

        <div class="ticket-grid">
            @try
            {
                @if (Model != null && Model.VeTaus != null && Model.VeTaus.Any())
                {
                    @foreach (var veTau in Model.VeTaus)
                    {
                        <div class="ticket-card">
                            <div class="route">
                                <div class="origin">@veTau.GaDi</div>
                                <div class="trip-info">
                                    <div class="time">@veTau.NgayDi.ToString("HH:mm")</div>
                                    <div class="arrow">→</div>
                                    <div class="train-code">@veTau.TenTau</div>
                                </div>
                                <div class="destination">@veTau.GaDen</div>
                            </div>
                            <div class="ticket-group">
                                <div class="price">@string.Format("{0:N0}", veTau.GiaVe)<span>VNĐ</span></div>
                                <a href="@Url.Action("ChiTietVeTau", "VeTau", new { id = veTau.ChuyenTauID })" class="view-button">Xem</a>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <!-- Hiển thị dữ liệu mẫu khi không có dữ liệu thực -->
                    <div class="ticket-card">
                        <div class="route">
                            <div class="origin">Hà Nội</div>
                            <div class="trip-info">
                                <div class="time">6:00</div>
                                <div class="arrow">→</div>
                                <div class="train-code">SE1</div>
                            </div>
                            <div class="destination">Sài Gòn</div>
                        </div>
                        <div class="ticket-group">
                            <div class="price">935.000<span>VNĐ</span></div>
                            <a href="#" class="view-button">Xem</a>
                        </div>
                    </div>
                    <div class="ticket-card">
                        <div class="route">
                            <div class="origin">Hà Nội</div>
                            <div class="trip-info">
                                <div class="time">9:25</div>
                                <div class="arrow">→</div>
                                <div class="train-code">SE3</div>
                            </div>
                            <div class="destination">Đà Nẵng</div>
                        </div>
                        <div class="ticket-group">
                            <div class="price">750.000<span>VNĐ</span></div>
                            <a href="#" class="view-button">Xem</a>
                        </div>
                    </div>
                    <div class="ticket-card">
                        <div class="route">
                            <div class="origin">Sài Gòn</div>
                            <div class="trip-info">
                                <div class="time">8:20</div>
                                <div class="arrow">→</div>
                                <div class="train-code">SNT2</div>
                            </div>
                            <div class="destination">Nha Trang</div>
                        </div>
                        <div class="ticket-group">
                            <div class="price">385.000<span>VNĐ</span></div>
                            <a href="#" class="view-button">Xem</a>
                        </div>
                    </div>
                }
            }
            catch (Exception ex)
            {
                <div class="alert alert-danger">Có lỗi xảy ra: @ex.Message</div>

                <!-- Hiển thị dữ liệu mẫu khi có lỗi -->
                <div class="ticket-card">
                    <div class="route">
                        <div class="origin">Hà Nội</div>
                        <div class="trip-info">
                            <div class="time">6:00</div>
                            <div class="arrow">→</div>
                            <div class="train-code">SE1</div>
                        </div>
                        <div class="destination">Sài Gòn</div>
                    </div>
                    <div class="ticket-group">
                        <div class="price">935.000<span>VNĐ</span></div>
                        <a href="#" class="view-button">Xem</a>
                    </div>
                </div>
                <div class="ticket-card">
                    <div class="route">
                        <div class="origin">Hà Nội</div>
                        <div class="trip-info">
                            <div class="time">9:25</div>
                            <div class="arrow">→</div>
                            <div class="train-code">SE3</div>
                        </div>
                        <div class="destination">Đà Nẵng</div>
                    </div>
                    <div class="ticket-group">
                        <div class="price">750.000<span>VNĐ</span></div>
                        <a href="#" class="view-button">Xem</a>
                    </div>
                </div>
                <div class="ticket-card">
                    <div class="route">
                        <div class="origin">Sài Gòn</div>
                        <div class="trip-info">
                            <div class="time">8:20</div>
                            <div class="arrow">→</div>
                            <div class="train-code">SNT2</div>
                        </div>
                        <div class="destination">Nha Trang</div>
                    </div>
                    <div class="ticket-group">
                        <div class="price">385.000<span>VNĐ</span></div>
                        <a href="#" class="view-button">Xem</a>
                    </div>
                </div>
            }
        </div>

       
    </div>
</section>

<!-- JavaScript for station swapping functionality -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Thiết lập ngày mặc định cho lịch
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);

        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        const departDate = document.getElementById('depart-date');
        const returnDate = document.getElementById('return-date');

        if (departDate && returnDate) {
            departDate.value = formatDate(today);
            returnDate.value = formatDate(tomorrow);
        }

        // Swap stations functionality
        const swapButton = document.getElementById('swap-stations');
        const fromStation = document.getElementById('from-station');
        const toStation = document.getElementById('to-station');

        if (swapButton && fromStation && toStation) {
            swapButton.addEventListener('click', function() {
                const tempValue = fromStation.value;
                fromStation.value = toStation.value;
                toStation.value = tempValue;
            });
        }

        // Show/hide return date based on trip type
        const roundTrip = document.getElementById('round-trip');
        const oneWay = document.getElementById('one-way');
        const returnDateContainer = document.getElementById('return-date-container');

        if (roundTrip && oneWay && returnDateContainer) {
            roundTrip.addEventListener('change', function() {
                if(this.checked) {
                    returnDateContainer.style.display = 'block';
                }
            });

            oneWay.addEventListener('change', function() {
                if(this.checked) {
                    returnDateContainer.style.display = 'none';
                }
            });
        }

        // Ticket quantity control
        const decreaseBtn = document.getElementById('decrease-tickets');
        const increaseBtn = document.getElementById('increase-tickets');
        const ticketCount = document.getElementById('ticket-count');
        const ticketCountDisplay = document.getElementById('ticket-count-display');

        if (decreaseBtn && increaseBtn && ticketCount && ticketCountDisplay) {
            decreaseBtn.addEventListener('click', function() {
                let count = parseInt(ticketCount.value);
                if(count > 1) {
                    count--;
                    ticketCount.value = count;
                    ticketCountDisplay.textContent = count + ' vé';
                }
            });

            increaseBtn.addEventListener('click', function() {
                let count = parseInt(ticketCount.value);
                if(count < 10) {
                    count++;
                    ticketCount.value = count;
                    ticketCountDisplay.textContent = count + ' vé';
                }
            });
        }
    });
</script>